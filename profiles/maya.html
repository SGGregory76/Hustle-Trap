<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>🌸 Maya – Profile – Hustle Trap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Shared CSS (relative path) -->
  <link rel="stylesheet" href="../styles/profile.css">
</head>
<body>
  <div class="content">
    <!-- Header -->
    <div class="profile-header">
      <div class="avatar"></div>
      <div class="profile-header-text">
        <div class="name">🌸 Maya</div>
        <div class="doc">
          <span class="doc-label">DOC:</span>
          <span id="doc-icon" class="drug-icon"></span>
          <span id="doc-name"></span>
        </div>
      </div>
    </div>

    <!-- Your Stats -->
    <section class="section">
      <h3>🎯 Your Stats</h3>
      <div class="stats-card">
        <div class="stat">
          <div class="stat-title">⭐ XP</div>
          <div class="stat-value" id="stat-xp">0</div>
        </div>
        <div class="stat">
          <div class="stat-title">🏆 REP</div>
          <div class="stat-value" id="stat-rep">0</div>
        </div>
        <div class="stat">
          <div class="stat-title">🔥 Heat</div>
          <div class="stat-value" id="stat-heat">0</div>
        </div>
        <div class="stat">
          <div class="stat-title">💵 Cash</div>
          <div class="stat-value" id="stat-cash">$0</div>
        </div>
      </div>
    </section>

    <!-- Bio -->
    <section class="section profile-bio">
      Maya’s mood swings are legendary—she’s brilliant when focused but volatile under pressure. Handle with care, and her insights can pay off big.
    </section>

    <!-- Actions -->
    <div class="profile-actions">
      <a href="/p/cash-apps.html?to=MayaTrap&action=send&m=1">💵 Pay Maya</a>
    </div>

    <!-- Trust -->
    <section class="section">
      <h3>🤝 Trust</h3>
      <div class="trust-bar">
        <div id="trust-fill" class="trust-fill"></div>
      </div>
      <div id="trust-percent">0%</div>
    </section>

    <!-- Recipes -->
    <section class="section">
      <h3>⚗️ Recipes</h3>
      <ul class="item-list" id="npcRecipes"></ul>
    </section>

    <!-- Missions -->
    <section class="section">
      <h3>📋 Missions</h3>
      <ul class="item-list" id="npcMissions"></ul>
    </section>

    <!-- NPC Inventory -->
    <section class="section">
      <h3>📦 Maya's Inventory</h3>
      <ul class="item-list" id="npcInventory"></ul>
    </section>

    <!-- Player Inventory -->
    <section class="section">
      <h3>🎒 Your Inventory</h3>
      <ul class="item-list" id="playerInventory"></ul>
    </section>
  </div>

  <!-- Core Scripts (all relative so we know it’s your up-to-date code) -->
  <script src="../scripts/npc-data.js"   defer></script>
  <script src="../scripts/flag-manager.js" defer></script>
  <script src="../scripts/stats-engine.js" defer></script>
  <script src="../scripts/log-manager.js"  defer></script>
  <script src="../scripts/trust-bar.js"    defer></script>

  <!-- Initialization (runs after all scripts load) -->
  <script defer>
    window.addEventListener('load', function initMaya() {
      // Pull Maya’s shared data
      const npc = window.NPCData?.get('maya') || {};

      // Inject DOC icon and name
      if (npc.drugOfChoice) {
        document.getElementById('doc-icon').textContent = npc.drugOfChoice.icon;
        document.getElementById('doc-name').textContent = npc.drugOfChoice.name;
      }

      // Populate stats
      const stats = StatsEngine.get();
      document.getElementById('stat-xp').textContent   = stats.xp ?? 0;
      document.getElementById('stat-rep').textContent  = stats.rep ?? 0;
      document.getElementById('stat-heat').textContent = stats.heat ?? 0;
      document.getElementById('stat-cash').textContent = `$${stats.cash ?? 0}`;

      // Render recipes
      const recipes = [
        { id:'starter_weed', name:'Starter Weed', icon:'🌿', requires:{cash:50}, gives:['starter_weed'], xpReward:5, unlockCondition:true },
        { id:'weed_oil',     name:'Weed Oil',      icon:'🛢️', requires:{starter_weed:2}, gives:['weed_oil'],    xpReward:10, unlockCondition: stats.rep >= 1 },
        { id:'joint_pack',   name:'Joint Pack',    icon:'🚬', requires:{weed_oil:1,starter_weed:1}, gives:['joint_pack'], xpReward:15, unlockCondition: stats.xp  >= 10 },
        { id:'hash',         name:'Bubble Hash',   icon:'🔥', requires:{starter_weed:5}, gives:['hash'],       xpReward:25, unlockCondition: stats.rep >= 5 }
      ];
      const recipeList = document.getElementById('npcRecipes');
      recipeList.innerHTML = '';
      recipes.forEach(r => {
        const hasResources = Object.entries(r.requires).every(([k,v]) =>
          k === 'cash'
            ? stats.cash >= v
            : (JSON.parse(localStorage.getItem('playerInventory')||'{}')[k]||0) >= v
        );
        const unlocked = r.unlockCondition && hasResources;
        recipeList.innerHTML += `
          <li>
            <span>${r.icon} ${r.name}</span>
            <button ${!unlocked?'disabled':''}
                    onclick="unlockRecipe('${r.id}')">
              ${unlocked ? 'Unlock' : 'Locked'}
            </button>
          </li>`;
      });

      window.unlockRecipe = function(id) {
        const r = recipes.find(x=>x.id===id);
        if (!r) return;
        // Deduct costs
        Object.entries(r.requires).forEach(([k,v])=>{
          if (k==='cash') {
            stats.cash -= v;
            StatsEngine.set(stats);
          } else {
            const inv = JSON.parse(localStorage.getItem('playerInventory')||'{}');
            inv[k] = (inv[k]||0) - v;
            localStorage.setItem('playerInventory', JSON.stringify(inv));
          }
        });
        // Add outputs
        const inv = JSON.parse(localStorage.getItem('playerInventory')||'{}');
        r.gives.forEach(i=>inv[i]=(inv[i]||0)+1);
        localStorage.setItem('playerInventory', JSON.stringify(inv));
        // Award XP & log
        stats.xp += r.xpReward;
        StatsEngine.set(stats);
        LogManager.add(`🧪 Crafted ${r.name}. +${r.xpReward} XP`);
        // Refresh the page so buttons/stats update
        window.location.reload();
      };

      // Render missions
      const missions = [
        { id:'maya_prologue', name:'Prologue – Meet Maya', icon:'🌸', url:'/p/maya-prologue.html?m=1' }
      ];
      const missionList = document.getElementById('npcMissions');
      missionList.innerHTML = '';
      missions.forEach(m => {
        const done = FlagManager.get(m.id);
        missionList.innerHTML += `
          <li>
            <span>${m.icon} ${m.name}</span>
            <button ${done?'disabled':''}
                    onclick="location.href='${m.url}'">
              ${done ? '✓ Completed' : 'Start'}
            </button>
          </li>`;
      });
    });
  </script>
</body>
</html>
