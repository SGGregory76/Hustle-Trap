<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ğŸŒ¸ Maya â€“ Profile â€“ Hustle Trap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Shared CSS via jsDelivr -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/SGGregory76/Hustle-Trap@main/styles/profile.css"
  >
</head>
<body>
  <div class="content">
    <!-- Header -->
    <div class="profile-header">
      <div class="avatar"></div>
      <div class="profile-header-text">
        <div class="name">ğŸŒ¸ Maya</div>
        <div class="doc">
          <span class="doc-label">DOC:</span>
          <span id="doc-icon" class="drug-icon"></span>
          <span id="doc-name"></span>
        </div>
      </div>
    </div>

    <!-- Your Stats -->
    <section class="section">
      <h3>ğŸ¯ Your Stats</h3>
      <div class="stats-card">
        <div class="stat"><div class="stat-title">â­ XP</div><div class="stat-value" id="stat-xp">0</div></div>
        <div class="stat"><div class="stat-title">ğŸ† REP</div><div class="stat-value" id="stat-rep">0</div></div>
        <div class="stat"><div class="stat-title">ğŸ”¥ Heat</div><div class="stat-value" id="stat-heat">0</div></div>
        <div class="stat"><div class="stat-title">ğŸ’µ Cash</div><div class="stat-value" id="stat-cash">$0</div></div>
      </div>
    </section>

    <!-- Bio -->
    <section class="section profile-bio">
      Mayaâ€™s mood swings are legendaryâ€”sheâ€™s brilliant when focused but volatile under pressure. Handle with care, and her insights can pay off big.
    </section>

    <!-- Actions -->
    <div class="profile-actions">
      <a href="/p/cash-apps.html?to=MayaTrap&action=send&m=1">ğŸ’µ Pay Maya</a>
    </div>

    <!-- Trust -->
    <section class="section">
      <h3>ğŸ¤ Trust</h3>
      <div class="trust-bar"><div id="trust-fill" class="trust-fill"></div></div>
      <div id="trust-percent">0%</div>
    </section>

    <!-- Recipes -->
    <section class="section">
      <h3>âš—ï¸ Recipes</h3>
      <ul class="item-list" id="npcRecipes"></ul>
    </section>

    <!-- Missions -->
    <section class="section">
      <h3>ğŸ“‹ Missions</h3>
      <ul class="item-list" id="npcMissions"></ul>
    </section>

    <!-- Inventories -->
    <section class="section">
      <h3>ğŸ“¦ Maya's Inventory</h3>
      <ul class="item-list" id="npcInventory"></ul>
    </section>
    <section class="section">
      <h3>ğŸ’ Your Inventory</h3>
      <ul class="item-list" id="playerInventory"></ul>
    </section>
  </div>

  <!-- Core Scripts via jsDelivr -->
  <script src="https://cdn.jsdelivr.net/gh/SGGregory76/Hustle-Trap@main/scripts/npc-data.js" defer></script>
  <script src="https://cdn.jsdelivr.net/gh/SGGregory76/Hustle-Trap@main/scripts/flag-manager.js" defer></script>
  <script src="https://cdn.jsdelivr.net/gh/SGGregory76/Hustle-Trap@main/scripts/stats-engine.js" defer></script>
  <script src="https://cdn.jsdelivr.net/gh/SGGregory76/Hustle-Trap@main/scripts/log-manager.js" defer></script>
  <script src="https://cdn.jsdelivr.net/gh/SGGregory76/Hustle-Trap@main/scripts/trust-bar.js" defer></script>

  <!-- Initialization -->
  <script defer>
    document.addEventListener('DOMContentLoaded', function() {
      // 1. Load Mayaâ€™s metadata
      const npc = window.NPCData?.get('maya') || {};

      // 2. Inject DOC
      if (npc.drugOfChoice) {
        document.getElementById('doc-icon').textContent = npc.drugOfChoice.icon;
        document.getElementById('doc-name').textContent = npc.drugOfChoice.name;
      }

      // 3. Populate Stats
      const stats = StatsEngine.get();
      document.getElementById('stat-xp').textContent   = stats.xp ?? 0;
      document.getElementById('stat-rep').textContent  = stats.rep ?? 0;
      document.getElementById('stat-heat').textContent = stats.heat ?? 0;
      document.getElementById('stat-cash').textContent = `$${stats.cash ?? 0}`;

      // 4. Render Recipes
      const recipes = [
        { id:'starter_weed', name:'Starter Weed', icon:'ğŸŒ¿', requires:{cash:50}, gives:['starter_weed'], xpReward:5,  unlockCondition:true },
        { id:'weed_oil',     name:'Weed Oil',      icon:'ğŸ›¢ï¸', requires:{starter_weed:2}, gives:['weed_oil'],    xpReward:10, unlockCondition: stats.rep >= 1 },
        { id:'joint_pack',   name:'Joint Pack',    icon:'ğŸš¬', requires:{weed_oil:1,starter_weed:1}, gives:['joint_pack'], xpReward:15, unlockCondition: stats.xp  >= 10 },
        { id:'hash',         name:'Bubble Hash',   icon:'ğŸ”¥', requires:{starter_weed:5}, gives:['hash'],       xpReward:25, unlockCondition: stats.rep >= 5 }
      ];
      const recipeList = document.getElementById('npcRecipes');
      recipeList.innerHTML = '';
      recipes.forEach(r => {
        const has = Object.entries(r.requires).every(([k,v]) =>
          k === 'cash'
            ? stats.cash >= v
            : (JSON.parse(localStorage.getItem('playerInventory')||'{}')[k]||0) >= v
        );
        recipeList.innerHTML += `
          <li>
            <span>${r.icon} ${r.name}</span>
            <button ${!(r.unlockCondition && has)?'disabled':''} onclick="unlockRecipe('${r.id}')">
              ${r.unlockCondition && has ? 'Unlock' : 'Locked'}
            </button>
          </li>`;
      });

      window.unlockRecipe = id => {
        const r = recipes.find(x => x.id===id);
        if (!r) return;
        // Deduct
        Object.entries(r.requires).forEach(([k,v])=>{
          if (k==='cash') {
            stats.cash -= v; StatsEngine.set(stats);
          } else {
            const inv=JSON.parse(localStorage.getItem('playerInventory')||'{}');
            inv[k] = (inv[k]||0)-v;
            localStorage.setItem('playerInventory',JSON.stringify(inv));
          }
        });
        // Give
        const inv=JSON.parse(localStorage.getItem('playerInventory')||'{}');
        r.gives.forEach(i=>inv[i]=(inv[i]||0)+1);
        localStorage.setItem('playerInventory',JSON.stringify(inv));
        // XP & log
        stats.xp += r.xpReward; StatsEngine.set(stats);
        LogManager.add(`ğŸ§ª Crafted ${r.name}. +${r.xpReward} XP`);
        // Refresh
        window.location.reload();
      };

      // 5. Render Missions
      const missions = [
        { id:'maya_prologue', name:'Prologue â€“ Meet Maya', icon:'ğŸŒ¸', url:'/p/maya-prologue.html?m=1' }
      ];
      const missionList = document.getElementById('npcMissions');
      missionList.innerHTML = '';
      missions.forEach(m => {
        const done = FlagManager.get(m.id);
        missionList.innerHTML += `
          <li>
            <span>${m.icon} ${m.name}</span>
            <button ${done?'disabled':''} onclick="location.href='${m.url}'">
              ${done ? 'âœ“ Completed' : 'Start'}
            </button>
          </li>`;
      });
    });
  </script>
</body>
</html>
